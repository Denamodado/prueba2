<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Previsualizador de Imágenes</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Puedes agregar estilos adicionales aquí si lo deseas */
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Instrucciones -->
    <div class="p-4 bg-blue-500 text-white text-center">
        <h1 class="text-2xl font-bold">Previsualizador de Imágenes</h1>
        <p>Abre y utiliza la aplicación haciendo doble clic en este archivo HTML.</p>
    </div>

    <!-- Contenedor principal -->
    <div class="flex-grow container mx-auto p-4">

        <!-- Área de arrastre y carga -->
        <div id="drop-area" class="border-4 border-dashed border-gray-300 rounded-lg p-8 flex flex-col items-center justify-center cursor-pointer bg-white">
            <p id="placeholder-text" class="text-gray-500 text-center">
                Arrastra y suelta tus imágenes aquí o haz doble clic para cargar.
            </p>
            <input type="file" id="fileElem" multiple accept="image/*" class="hidden">
        </div>

        <!-- Galería de imágenes -->
        <div id="gallery" class="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Las imágenes se insertarán aquí -->
        </div>

    </div>

    <!-- JavaScript -->
    <script>
        // Variables globales
        let images = [];

        // Tu Client ID de Imgur
        const CLIENT_ID = 'TU_CLIENT_ID';

        // Cargar imágenes desde LocalStorage al iniciar
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar imágenes desde LocalStorage
            if (localStorage.getItem('images')) {
                images = JSON.parse(localStorage.getItem('images'));
                updateGallery();
            }

            // Elementos del DOM
            const dropArea = document.getElementById('drop-area');
            const fileElem = document.getElementById('fileElem');

            // Evento de doble clic para abrir el selector de archivos
            dropArea.addEventListener('dblclick', () => {
                fileElem.click();
            });

            // Eventos de arrastrar y soltar
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('border-blue-500');
            });

            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('border-blue-500');
            });

            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('border-blue-500');
                let dt = e.dataTransfer;
                let files = dt.files;
                handleFiles(files);
            });

            // Evento de cambio en el input de archivos
            fileElem.addEventListener('change', () => {
                handleFiles(fileElem.files);
            });
        });

        // Manejar archivos seleccionados
        function handleFiles(files) {
            [...files].forEach(uploadImage);
        }

        // Subir imagen a Imgur
        function uploadImage(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function() {
                const base64Image = reader.result.split(',')[1];
                const url = 'https://api.imgur.com/3/image';

                fetch(url, {
                    method: 'POST',
                    headers: {
                        Authorization: 'Client-ID ' + CLIENT_ID,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        image: base64Image,
                        type: 'base64',
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const imageUrl = data.data.link;
                        images.push(imageUrl);
                        saveImages();
                        updateGallery();
                    } else {
                        console.error('Error al subir la imagen:', data);
                        alert('Se produjo un error al subir la imagen.');
                    }
                })
                .catch(error => {
                    console.error('Error al subir la imagen:', error);
                    alert('Se produjo un error al subir la imagen.');
                });
            };
            reader.onerror = function(error) {
                console.error('Error al leer el archivo:', error);
                alert('Se produjo un error al cargar la imagen.');
            };
        }

        // Actualizar galería
        function updateGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            if (images.length === 0) {
                document.getElementById('placeholder-text').style.display = 'block';
            } else {
                document.getElementById('placeholder-text').style.display = 'none';
            }

            images.forEach((imageSrc, index) => {
                const div = document.createElement('div');
                div.classList.add('relative', 'group');

                const img = document.createElement('img');
                img.src = imageSrc;
                img.classList.add('w-full', 'h-auto', 'rounded-lg');

                // Botón de eliminar
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '✕';
                deleteBtn.setAttribute('aria-label', 'Eliminar imagen');
                deleteBtn.classList.add('absolute', 'top-2', 'right-2', 'bg-red-500', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center', 'opacity-0', 'group-hover:opacity-100', 'transition');
                deleteBtn.onclick = () => {
                    images.splice(index, 1);
                    saveImages();
                    updateGallery();
                };

                div.appendChild(img);
                div.appendChild(deleteBtn);
                gallery.appendChild(div);
            });
        }

        // Guardar imágenes en LocalStorage
        function saveImages() {
            localStorage.setItem('images', JSON.stringify(images));
        }
    </script>
</body>
</html>

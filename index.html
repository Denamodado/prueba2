<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Analyzer with Persistent Storage</title>
</head>
<body>
    <h2>Cargar Imágenes</h2>
    <input type="file" id="imageUpload" multiple>
    <div id="imageData"></div>

    <script>
        // Cargar imágenes desde localStorage al iniciar la página
        window.onload = function() {
            const storedImages = JSON.parse(localStorage.getItem('images')) || [];
            const imageDataContainer = document.getElementById('imageData');
            storedImages.forEach(({ name, src, width, height, color, size }) => {
                const infoDiv = document.createElement('div');
                infoDiv.innerHTML = `
                    <img src="${src}" alt="${name}" width="100">
                    <p>Image: ${name}</p>
                    <p>Dimensions: ${width} x ${height}</p>
                    <p>Average Color: ${color}</p>
                    <p>Size: ${size} KB</p>
                `;
                imageDataContainer.appendChild(infoDiv);
            });
        };

        document.getElementById('imageUpload').addEventListener('change', function(event) {
            const files = event.target.files;
            const imageDataContainer = document.getElementById('imageData');
            imageDataContainer.innerHTML = '';

            const storedImages = [];

            Array.from(files).forEach(file => {
                const img = new Image();
                img.src = URL.createObjectURL(file);

                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    const imageData = ctx.getImageData(0, 0, img.width, img.height).data;
                    let r = 0, g = 0, b = 0, totalPixels = img.width * img.height;

                    for (let i = 0; i < imageData.length; i += 4) {
                        r += imageData[i];
                        g += imageData[i + 1];
                        b += imageData[i + 2];
                    }

                    r = Math.round(r / totalPixels);
                    g = Math.round(g / totalPixels);
                    b = Math.round(b / totalPixels);

                    const color = `rgb(${r}, ${g}, ${b})`;
                    const size = (file.size / 1024).toFixed(2);

                    const infoDiv = document.createElement('div');
                    infoDiv.innerHTML = `
                        <img src="${img.src}" alt="${file.name}" width="100">
                        <p>Image: ${file.name}</p>
                        <p>Dimensions: ${img.width} x ${img.height}</p>
                        <p>Average Color: ${color}</p>
                        <p>Size: ${size} KB</p>
                    `;
                    imageDataContainer.appendChild(infoDiv);

                    // Guardar imagen en `localStorage`
                    storedImages.push({
                        name: file.name,
                        src: img.src,
                        width: img.width,
                        height: img.height,
                        color: color,
                        size: size
                    });
                    localStorage.setItem('images', JSON.stringify(storedImages));
                };
            });
        });
    </script>
</body>
</html>

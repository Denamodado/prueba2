<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Gestor de Proyectos</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .bg-custom { background-color: #f5f0e1; }
    .bg-card { background-color: #fff; }
    .text-primary { color: #4b3c2e; }
    .btn-primary { background-color: #5a7f45; color: white; }
  </style>
</head>
<body class="bg-custom min-h-screen flex flex-col items-center p-4">
  <header class="w-full text-center mb-4">
    <h1 class="text-4xl font-bold text-primary">Mini Gestor de Proyectos</h1>
    <input type="text" id="searchBar" placeholder="Buscar proyectos..." class="w-full max-w-md p-2 border border-gray-300 rounded mt-4 mb-4">
    <select id="categoryFilter" class="w-full max-w-md p-2 border border-gray-300 rounded mb-4">
      <option value="">Todas las categorías</option>
      <option value="Alta">Alta Prioridad</option>
      <option value="Media">Media Prioridad</option>
      <option value="Baja">Baja Prioridad</option>
    </select>
  </header>

  <div id="kanbanBoard" class="grid grid-cols-3 gap-4 w-full max-w-4xl">
    <div id="todo" class="bg-card p-4 rounded-lg shadow"><h2 class="text-2xl font-semibold mb-2 text-primary">To Do</h2></div>
    <div id="inProgress" class="bg-card p-4 rounded-lg shadow"><h2 class="text-2xl font-semibold mb-2 text-primary">In Progress</h2></div>
    <div id="done" class="bg-card p-4 rounded-lg shadow"><h2 class="text-2xl font-semibold mb-2 text-primary">Done</h2></div>
  </div>

  <button onclick="openProjectModal()" class="mt-4 px-4 py-2 btn-primary rounded-lg shadow">Nuevo Proyecto</button>

  <div id="projectModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden">
    <div class="bg-card p-4 w-96 rounded-lg shadow">
      <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-primary">Nuevo Proyecto</h3>
      <input id="projectTitle" type="text" placeholder="Nombre del Proyecto" class="w-full p-2 border rounded mb-4">
      <textarea id="projectDescription" placeholder="Descripción del Proyecto" class="w-full p-2 border rounded mb-4"></textarea>
      <select id="projectCategory" class="w-full p-2 border rounded mb-4">
        <option value="Alta">Alta Prioridad</option>
        <option value="Media">Media Prioridad</option>
        <option value="Baja">Baja Prioridad</option>
      </select>

      <!-- Drag-and-Drop Image Upload -->
      <div id="dropZone" class="border-2 border-dashed border-gray-300 p-4 rounded text-center text-gray-500 mb-4"
        ondrop="handleDrop(event)" ondragover="event.preventDefault()">
        Arrastra las imágenes aquí o haz clic para seleccionarlas
        <input id="projectImages" type="file" accept="image/*" multiple class="hidden" onchange="handleFileSelect(event)">
      </div>
      <div id="imagePreview" class="flex flex-wrap gap-2 mb-4"></div>

      <div class="flex justify-end">
        <button onclick="closeProjectModal()" class="px-4 py-2 btn-primary rounded-lg">Cancelar</button>
        <button onclick="saveProject()" class="px-4 py-2 btn-primary rounded-lg">Guardar</button>
      </div>
    </div>
  </div>

  <script>
    let projects = JSON.parse(localStorage.getItem("projects")) || [];
    let editingProjectId = null;
    let selectedImages = [];

    document.addEventListener("DOMContentLoaded", loadProjects);
    document.getElementById("searchBar").addEventListener("input", filterProjects);
    document.getElementById("categoryFilter").addEventListener("change", filterProjects);

    function loadProjects() {
      const columns = { todo: [], inProgress: [], done: [] };
      projects.forEach(project => columns[project.status].push(project));
      renderProjects(columns);
    }

    function renderProjects(columns) {
      ["todo", "inProgress", "done"].forEach(status => {
        const column = document.getElementById(status);
        column.innerHTML = "";
        columns[status].forEach(project => {
          const projectEl = document.createElement("div");
          projectEl.className = "project p-4 bg-card rounded-lg shadow mb-2";
          projectEl.draggable = true;
          projectEl.ondragstart = e => drag(e, project.id);
          projectEl.onclick = () => openProjectModal(project);
          projectEl.innerHTML = `
            <h4 class="font-semibold text-primary">${project.title}</h4>
            <p class="text-sm">${project.description}</p>
            <span class="text-xs text-gray-500">Prioridad: ${project.category}</span>
            ${project.images.map(img => `<img src="${img}" class="w-16 h-16 object-cover mt-2 rounded-lg">`).join('')}
          `;
          column.appendChild(projectEl);
        });
      });
    }

    function openProjectModal(project = null) {
      document.getElementById("projectModal").classList.remove("hidden");
      editingProjectId = project ? project.id : null;
      document.getElementById("modalTitle").innerText = project ? "Editar Proyecto" : "Nuevo Proyecto";
      document.getElementById("projectTitle").value = project ? project.title : "";
      document.getElementById("projectDescription").value = project ? project.description : "";
      document.getElementById("projectCategory").value = project ? project.category : "Alta";
      selectedImages = project && project.images ? project.images.slice() : [];
      renderImagePreview();
    }

    function closeProjectModal() {
      document.getElementById("projectModal").classList.add("hidden");
      selectedImages = [];
    }

    function saveProject() {
      const title = document.getElementById("projectTitle").value;
      const description = document.getElementById("projectDescription").value;
      const category = document.getElementById("projectCategory").value;

      if (!title) {
        alert("Por favor, ingrese un nombre para el proyecto.");
        return;
      }

      const newProject = {
        id: editingProjectId || new Date().getTime().toString(),
        title,
        description,
        category,
        images: selectedImages,
        status: "todo"
      };

      if (editingProjectId) {
        const index = projects.findIndex(p => p.id === editingProjectId);
        projects[index] = newProject;
      } else {
        projects.push(newProject);
      }

      localStorage.setItem("projects", JSON.stringify(projects));
      closeProjectModal();
      loadProjects();
    }

    function handleFileSelect(event) {
      const files = event.target.files || event.dataTransfer.files;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          selectedImages.push(e.target.result);
          renderImagePreview();
        };
        reader.readAsDataURL(file);
      });
    }

    function renderImagePreview() {
      const previewContainer = document.getElementById("imagePreview");
      previewContainer.innerHTML = "";
      selectedImages.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        img.className = "w-16 h-16 object-cover rounded-lg shadow";
        previewContainer.appendChild(img);
      });
    }

    function drag(event, projectId) {
      event.dataTransfer.setData("projectId", projectId);
    }

    function drop(event) {
      event.preventDefault();
      const projectId = event.dataTransfer.getData("projectId");
      const newStatus = event.currentTarget.id;
      const project = projects.find(p => p.id === projectId);
      project.status = newStatus;
      localStorage.setItem("projects", JSON.stringify(projects));
      loadProjects();
    }

    function filterProjects() {
      const searchText = document.getElementById("searchBar").value.toLowerCase();
      const category = document.getElementById("categoryFilter").value;
      const filteredProjects = projects.filter(project => {
        return (
          (!searchText || project.title.toLowerCase().includes(searchText)) &&
          (!category || project.category === category)
        );
      });
      const columns = { todo:Here is the rest of the JavaScript to continue filtering and rendering the kanban columns after filtering:

```html
      const columns = { todo: [], inProgress: [], done: [] };
      filteredProjects.forEach(project => columns[project.status].push(project));
      renderProjects(columns);
    }

    ["todo", "inProgress", "done"].forEach(status => {
      document.getElementById(status).addEventListener("drop", drop);
      document.getElementById(status).addEventListener("dragover", event => event.preventDefault());
    });

    document.getElementById("dropZone").addEventListener("click", () => {
      document.getElementById("projectImages").click();
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Previsualizador de Imágenes</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Añade estilos adicionales si es necesario */
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Instrucciones -->
    <div class="p-4 bg-blue-500 text-white text-center">
        <h1 class="text-2xl font-bold">Previsualizador de Imágenes</h1>
        <p>Abre y utiliza la aplicación haciendo doble clic en este archivo HTML.</p>
    </div>

    <!-- Contenedor principal -->
    <div class="flex-grow container mx-auto p-4">

        <!-- Área de arrastre y carga -->
        <div id="drop-area" class="border-4 border-dashed border-gray-300 rounded-lg p-8 flex flex-col items-center justify-center cursor-pointer bg-white">
            <p id="placeholder-text" class="text-gray-500 text-center">
                Arrastra y suelta tus imágenes aquí o haz doble clic para cargar.
            </p>
            <input type="file" id="fileElem" multiple accept="image/*" class="hidden">
        </div>

        <!-- Galería de imágenes -->
        <div id="gallery" class="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Las imágenes se insertarán aquí -->
        </div>

    </div>

    <!-- JavaScript -->
    <script>
        // Variables globales
        let images = [];

        // Cargar imágenes desde LocalStorage al iniciar y asignar eventos
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar imágenes desde LocalStorage
            if (localStorage.getItem('images')) {
                images = JSON.parse(localStorage.getItem('images'));
                updateGallery();
            }

            // Elementos del DOM
            const dropArea = document.getElementById('drop-area');
            const fileElem = document.getElementById('fileElem');

            // Evento de doble clic para abrir el selector de archivos
            dropArea.addEventListener('dblclick', () => {
                fileElem.click();
            });

            // Eventos de arrastrar y soltar
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('border-blue-500');
            });

            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('border-blue-500');
            });

            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('border-blue-500');
                let dt = e.dataTransfer;
                let files = dt.files;
                handleFiles(files);
            });

            // Evento de cambio en el input de archivos
            fileElem.addEventListener('change', () => {
                handleFiles(fileElem.files);
            });
        });

        // Manejar archivos seleccionados
        function handleFiles(files) {
            [...files].forEach(previewFile);
        }

        // Previsualizar y almacenar archivos
        function previewFile(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(event) {
                const imageDataUrl = event.target.result;
                images.push(imageDataUrl);
                saveImages();
                updateGallery();
            };
            reader.onerror = function(error) {
                console.error('Error al leer el archivo:', error);
                alert('Se produjo un error al cargar la imagen.');
            };
        }

        // Actualizar galería
        function updateGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            if (images.length === 0) {
                document.getElementById('placeholder-text').style.display = 'block';
            } else {
                document.getElementById('placeholder-text').style.display = 'none';
            }

            images.forEach((imageSrc, index) => {
                const div = document.createElement('div');
                div.classList.add('relative', 'group');

                const img = document.createElement('img');
                img.src = imageSrc;
                img.classList.add('w-full', 'h-auto', 'rounded-lg');

                // Botón de eliminar
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '✕';
                deleteBtn.setAttribute('aria-label', 'Eliminar imagen');
                deleteBtn.classList.add('absolute', 'top-2', 'right-2', 'bg-red-500', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center', 'opacity-0', 'group-hover:opacity-100', 'transition');
                deleteBtn.onclick = () => {
                    images.splice(index, 1);
                    saveImages();
                    updateGallery();
                };

                // Botón de sustituir
                const replaceBtn = document.createElement('button');
                replaceBtn.innerHTML = '⟳';
                replaceBtn.setAttribute('aria-label', 'Sustituir imagen');
                replaceBtn.classList.add('absolute', 'top-2', 'left-2', 'bg-yellow-500', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center', 'opacity-0', 'group-hover:opacity-100', 'transition');
                replaceBtn.onclick = () => {
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = 'image/*';
                    fileInput.onchange = () => {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = function(event) {
                            images[index] = event.target.result;
                            saveImages();
                            updateGallery();
                        };
                        reader.onerror = function(error) {
                            console.error('Error al leer el archivo:', error);
                            alert('Se produjo un error al cargar la imagen.');
                        };
                    };
                    fileInput.click();
                };

                div.appendChild(img);
                div.appendChild(deleteBtn);
                div.appendChild(replaceBtn);
                gallery.appendChild(div);
            });
        }

        // Guardar imágenes en LocalStorage
        function saveImages() {
            try {
                localStorage.setItem('images', JSON.stringify(images));
            } catch (e) {
                console.error('Error al guardar en LocalStorage:', e);
                alert('No se pudieron guardar las imágenes. Puede que hayas excedido el límite de almacenamiento.');
            }
        }
    </script>
</body>
</html>
